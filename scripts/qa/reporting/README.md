# Reporting Scripts

This directory contains some utility scripts used for generating reports of QA processes.

* [`latency_throughput.py`](./latency_throughput.py) is a Python script that uses
    [matplotlib] to plot a graph of transaction latency vs throughput rate based on
    the CSV output generated by the [loadtime reporting
    tool](../../../test/loadtime/cmd/report/).

* [`latency_plotter.py`](./latency_plotter.py) is a Python script that uses
    [matplotlib] and [pandas] to plot graph of transaction latency vs throughput rate based on
    the CSV output generated by the [loadtime reporting
    tool](../../../test/loadtime/cmd/report/), for multiple experiments and configurations.

* [`prometheus_plotter.py`](./prometheus_plotter.py) is a Python script that uses
    [matplotlib] and [pandas] to plot graphs of several metrics from Prometheus.

## Setup

Before running the Python scripts, execute the following within this directory (the same directory
as the `latency_throughput.py` file).

```bash
# Create a virtual environment into which to install your dependencies
python3 -m venv .venv

# Activate the virtual environment
source .venv/bin/activate

# Install dependencies listed in requirements.txt
pip install -r requirements.txt
```

## Latency vs Throughput Plotting

To show the instructions and parameter options, execute 
```bash
./latency_throughput.py --help
```
Be sure that the virtual environment is enabled before running the script.

For example, the following command will generate a PNG file called `cmt_v1.png` in the current
directory based on the `raw.csv` file generated by the reporting tool. The `-t` flag overrides the
default title at the top of the plot.
```bash
./latency_throughput.py -t 'CometBFT v1.x Latency vs Throughput' ./cmt_v1.png /path/to/results/raw.csv
```

## Latency vs Throughput Plotting (version 2)

The `latency_plotter.py` script generates a series of plots in the `imgs` folder.
Plots include combined experiment plots and experiments as subplots.
- `all_experiments`: plots of all experiments as individual subplots.
- `all_configs`: plots of all experiments, grouped by configuration (r,c).
- `cXrY.png`: Independent plot of experiments of configuration (c=X,r=Y) as different curves.
- `cXrY_merged.png`: Independent plot of experiments of configuration (c=X,r=Y) combined as single curve.
- `e_ID.png`: independent plot with just experiment with id ID as a single curve.

Example:
```bash
./latency_plotter.py v1.0.0-alpha.2 /path/to/results/raw.csv
```
Be sure that the virtual environment is enabled before running the script.

## Prometheus metrics

The `prometheus_plotter.py` script generates a series of plots in the folder `imgs` of the current folder.

Before running the script, check that a Prometheus server in `localhost:9090`. This is the default URL hardcoded in the script.

Run the script from the virtual environment as follows:
```bash
./prometheus_plotter.py <release_name> <start_time> <window_size> <test_case>
```

For details and examples of how to run the script, just run `python3 prometheus_plotter.py` 

[matplotlib]: https://matplotlib.org/
[pandas]: https://pandas.pydata.org
